{% extends "base.html" %}
{% block title %}Theses{% endblock %}
{% block content %}
<h2 class="mb-4">Available Theses</h2>

<div class="list-group">
  {% for thesis in theses %}
    <div class="list-group-item">
      <h5>{{ thesis.title }}</h5>
      <p class="mb-1">{{ thesis.description }}</p>
      <small class="text-muted">Supervisor: {{ thesis.supervisor.username }}</small>

      {% if user.is_authenticated and user.role == "student" %}
        <!-- Button trigger modal -->
        <button class="btn btn-sm btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#applyModal{{ thesis.id }}">
          Apply
        </button>

        <!-- Modal -->
        <div class="modal fade" id="applyModal{{ thesis.id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <form method="post" action="{% url 'apply-to-thesis' thesis.id %}">
                {% csrf_token %}
                <div class="modal-header">
                  <h5 class="modal-title">Apply to "{{ thesis.title }}"</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                  <label for="motivation" class="form-label">Motivation Letter</label>
                  <textarea name="motivation" rows="5" class="form-control" required></textarea>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-success">Submit Application</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  {% empty %}
    <p>No theses available.</p>
  {% endfor %}
</div>
{% endblock %}
